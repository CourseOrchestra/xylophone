<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Xylophone</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="xylophone" class="article toc2 toc-left">
<div id="header">
<h1>Xylophone</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#general-information">General Information</a>
<ul class="sectlevel2">
<li><a href="#installation">Installation</a></li>
</ul>
</li>
<li><a href="#step-one-xls-and-xlsx-files-formation">Phase One: Producing XLS and XLSX Files</a>
<ul class="sectlevel2">
<li><a href="#system-usage">System Usage</a></li>
<li><a href="#controlled-xml-traversal">Controlled XML Traversal</a></li>
<li><a href="#representative-example">Example</a></li>
<li><a href="#the-sax-mode-for-huge-reports">The SAX Mode For Huge Reports</a></li>
</ul>
</li>
<li><a href="#stage-2-formation-of-pdf-files-and-output-for-printing">Phase 2. Output to PDF files and printer</a>
<ul class="sectlevel2">
<li><a href="#excel2print-module-usage">Excel2Print Module Usage</a></li>
<li><a href="#known-issues-and-an-alternative-way-for-printout">Known issues and an alternative way for printout</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="general-information">General Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/CourseOrchestra/xylophone">Xylophone</a> provides reports with a complex structure
in forms of spreadsheets (XLS or XLSX format), PDF files or direct output
for printing based on the XML input data. It can be used as command line tool and as a Java library.</p>
</div>
<div class="paragraph">
<p>The system has two separate XML parsing modes: DOM and SAX.
The DOM mode allows for greater flexibility in defining the structure of
the input data and the XML data reading with greater memory and
computational resource requirements as a cost. The SAX mode introduces a
few insignificant limitations on the XML file structure and on the
reports descriptor, though it outperforms XML mode both memory
consumption and performance wise and therefore is suitable for
generating huge reports.</p>
</div>
<div class="paragraph">
<p>Xylophone does not require Microsoft Excel or Adobe Acrobat installation as
well as any other software on the machine employed. The system utilizes
the following open source projects as dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://poi.apache.org/">Apache POI</a> — used in parsing and creation of
Excel-compatible data.</p>
</li>
<li>
<p><a href="https://xmlgraphics.apache.org/fop/">Apache FOP</a> — used in PDF creation
and printing output.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The general system’s data flow is showcased on the diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Xml2spreadsheet.png" alt="Xml2spreadsheet">
</div>
</div>
<div class="paragraph">
<p>The system’s input accepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML file with the source data.</p>
</li>
<li>
<p>.XLS or .XSLX template which defines the layout and format of the
output document.</p>
</li>
<li>
<p>XML descriptor designating the input data traversal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The output of the system is a file featuring the file extension and
format corresponding to the input template (.XLS in case the template was .XLS or
.XSLX otherwise). Further, the output XLS may be forwarded to the next
stage and converted into a PDF file or sent directly for printing.</p>
</div>
<div class="sect2">
<h3 id="installation">Installation</h3>
<div class="paragraph">
<p>A Zip archive “xylophone&#8230;&#8203;-bin.zip” with all the Java library dependencies can be
downloaded at <a href="https://repo1.maven.org/maven2/ru/curs/xylophone/">Maven Central</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-one-xls-and-xlsx-files-formation">Phase One: Producing XLS and XLSX Files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-usage">System Usage</h3>
<div class="paragraph">
<p>There are two ways to use the Xylophone:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>usage as a command-line tool.</p>
</li>
<li>
<p>Usage as a Java library.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="usage-as-a-command-line-tool">Usage As a Command-line Tool</h4>
<div class="paragraph">
<p>To use as a command line tool, unzip the “xylophone-VERSION-bin.zip”.
This archive contains folders named “lib” and “bin”. The “bin” folder
contains shell scripts for launching in Windows and Linux environment.</p>
</div>
<div class="paragraph">
<p>Execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xylophone -data datafile.xml -template template.xls[x] \
  -descr descriptor.xml -out result.xls [-sax] [-copytemplate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>datafile.xml — a file with the source XML data</p>
</li>
<li>
<p>template.xls[x] — a template with XLS or XLSX format</p>
</li>
<li>
<p>descriptor.xml — configuration file (previously mentioned as
“descriptor”)</p>
</li>
<li>
<p>result.xls — output file name. Its file extension determines the
output format, XLS or XLSX</p>
</li>
<li>
<p>sax — presence of this parameter defines if SAX parsing mode is to be
used (more information below)</p>
</li>
<li>
<p>copytemplate — presence of this parameter defines if the template will
be copied entirely to result with all of the contents present before the process.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="usage-as-a-library">Usage As a Library</h4>
<div class="paragraph">
<p>To use Xylophone as the library you need to import
<code>ru.curs.xylophone.XML2Spreadsheet</code> class and call its static method
called <code>process</code>: <code>XML2Spredsheet.process(&#8230;&#8203;)</code>. There are several
overloaded versions of this method with the following parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>File/InputStream <strong>xmlData</strong> — source data.</p>
</li>
<li>
<p>File/InputStream <strong>xmlDescriptor</strong> — descriptor data, describing the
order of data iteration.</p>
</li>
<li>
<p>File/InputStream <strong>template</strong> — the report template.</p>
</li>
<li>
<p>ru.curs.flute.xml2spreadsheet.OutputType <strong>outputType</strong> — report
template type (OpenOffice, XLS, XLSX). <em>This argument is omitted if the
arguments xmlData, xmlDescriptor, template are of type File. In such
case, the value of the argument is deduced by the template’s file
extension.</em></p>
</li>
<li>
<p>boolean <strong>useSAX</strong> — parsing mode, DOM if false, SAX if true, the
differences are listed below.</p>
</li>
<li>
<p>boolean <strong>copyTemplate</strong> — should the template be copied prior to data
emission. <em>Optional argument, false by default.</em> The option is used if
the existing contents of the templates need to be transferred to the
output. For instance, existing diagrams, graphics, and other things.</p>
</li>
<li>
<p>OutputStream <strong>output</strong> — the output stream which the system’s output
will be written into.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally there is the <strong>XML2Spreadsheet.toPOIWorkbook(xmlData,
xmlDescriptor, template, useSAX, copyTemplate)</strong> method, which returns an
instance of org.apache.poi.ss.usermodel.Workbook, serving an
object-based report representation. This method will be useful in cases
where a report is to go through additional post-processing step prior to
serialization.</p>
</div>
<div class="paragraph">
<p>Groovy example (try out this <a href="https://github.com/inponomarev/xylophone-example">demo project</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Grab('ru.curs:xylophone:6.1.9')
import ru.curs.xylophone.XML2Spreadsheet
baseDir = '.'
new File(baseDir, 'testdata.xml').withInputStream {
    input -&gt;
        new File(baseDir, 'report.xlsx').withOutputStream {
            output -&gt;
                XML2Spreadsheet.process(input,
                        new File(baseDir, 'descriptor.xml'),
                        new File(baseDir, 'template.xlsx'),
                        false, output)
        }
}
println 'Done.'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controlled-xml-traversal">Controlled XML Traversal</h3>
<div class="paragraph">
<p>Output to a spreadsheet document goes as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the system traverses the elements (tags) in the XML data file in a
specific way (the traverse algorithm is controlled by the XML
configuration file or a <em>descriptor file</em>),</p>
</li>
<li>
<p>at the specified moments the template fragments are copied to the
resulting document; the template data fields are filled with information
in the context of the current element in the XML data file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While traversing an XML data file the system can assume one of the three
modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Element reading mode</p>
</li>
<li>
<p>Output mode</p>
</li>
<li>
<p>Iteration mode</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The mode transition graph:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="diagram-state.png" alt="diagram state" width="501" height="293">
</div>
</div>
<div class="paragraph">
<p>The description of the XML data file traversal via the description of
three possible modes is below.</p>
</div>
<div class="sect3">
<h4 id="element-reading-mode">Element Reading Mode</h4>
<div class="paragraph">
<p>When processing starts, the system sets the root element in the data
document as current context and switches to the element reading mode. At
the beginning of processing, the system expects the root element of the
configuration file to be a tag of the kind
<code>&lt;element name="root_element_name"&gt;</code>, i.e. the value of the name
attribute of the root tag must match the name of the root element in the
data file. Otherwise, the system will not perform the output. That is,
if the data file has the following structure</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;root&gt;
    ...
&lt;/root&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the configuration file must look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;element name="root"&gt;
    ...
&lt;/element&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the other <code>&lt;element&gt;</code> tags must also have the <strong>name</strong> attribute.</p>
</div>
<div class="paragraph">
<p>In element reading mode, the system reads the child tags of the
<code>&lt;element&gt;</code> tag from the descriptor file. They can belong to one of
the following types: <code>&lt;output&gt;</code> and <code>&lt;iteration&gt;</code> The system switches to
output mode or iteration mode respectively. There can be any number of
<code>&lt;output&gt;</code> and <code>&lt;iteration&gt;</code> child tags in the <code>&lt;element&gt;</code> tag, and
they can go in any order, since the system processes them in sequence,
one after another.</p>
</div>
<div class="paragraph">
<p>The <strong>name</strong> attribute supports the following values:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Direct specification of the <strong>tag name</strong>. In this case, the
interpreter starts to process <code>&lt;element&gt;</code> only if the tag name in the
scanned data file matches the one specified in the attribute.</p>
</li>
<li>
<p><strong>*</strong> value (asterisk). In this case, any tag in the data file is
suitable for processing.</p>
</li>
<li>
<p>A simple XQuery expression of type <strong>tagname[@attribute='value']</strong>.
Processing occurs only when the tag name matches the tag name <strong>value</strong>,
and the attribute value equals <strong>value</strong>. NOTE: we only support
expressions of this type, with a single attribute and the "= " sign. The
<code>&lt;, &gt;</code> characters, and Boolean expressions with multiple conditions WILL
NOT work. Only a tagName[@attribute='value'] expression will work
(quotes can be single or double, depending on the circumstances, using
<strong>"</strong> is also allowed).</p>
</li>
<li>
<p><strong>(before)</strong> and <strong>(after)</strong> values. They are used to output a
"prologue" and "epilogue" of a sequence of elements.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="iteration-mode">Iteration Mode</h4>
<div class="paragraph">
<p>In iteration mode the system works as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The context value of the current data item is remembered in order to
restore it after the iteration is completed.</p>
</li>
<li>
<p>Then, depending on the value of the <strong>index</strong> attribute:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>&lt;iteration&gt;</code> tag does not have an <strong>index</strong> attribute, all
subelements of the current element of data document are read, and each
of them is set as the current one successively.</p>
</li>
<li>
<p>If the <code>&lt;iteration&gt;</code> tag has an <strong>index</strong> attribute, it is read, and
set as the current specific subelement of the current element. The value
of the <strong>index</strong> attribute can be an integer starting from zero.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After the next current element is read and set, the system
sequentially reads all subelements of the <code>&lt;iteration&gt;</code> tag, which can
only be of the <code>&lt;element&gt;</code> type.</p>
</li>
<li>
<p>If the <code>&lt;element&gt;</code> tag with the name=”(before)" attribute is
encountered, then the parent data element is processed first, making it
possible to output the “header” of the elements sequence.</p>
</li>
<li>
<p>If the value of the name attribute of the <code>&lt;element&gt;</code> tag matches with
the name of the current element (or the name attribute is set to '*'),
the system switches to the element reading mode described above.</p>
</li>
<li>
<p>If the <code>&lt;element&gt;</code> tag with the name=”(after)" attribute is
encountered, the parent data element is processed last, making it
possible to output the “footer” of the elements sequence.</p>
</li>
<li>
<p><code>&lt;iteration&gt;</code> tag can have a <strong>mode</strong> attribute, setting the mode of
template fragments composition in the output file. Possible values are:</p>
<div class="ulist">
<ul>
<li>
<p>no value – the template fragments that are presented in output mode
are arranged from top to bottom in the resulting document.</p>
</li>
<li>
<p><strong>horizontal</strong> – template fragments are arranged from left to right in
the resulting document.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>&lt;iteration&gt;</code> tag can have the <strong>regionName</strong> attribute. If this
attribute is set, then the iteration-formed block at the end of the
iteration will be converted to a named range with the specified name.</p>
</li>
<li>
<p>After the iteration is completed, the system restores the context
value of the current element for subelements that started the iteration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since there can be any number of <code>&lt;iteration&gt;</code> tags inside the
<code>&lt;element&gt;</code> tag and any number of <code>&lt;element&gt;</code> tags inside the
<code>&lt;iteration&gt;</code> tag, this allows you to flexibly organize complex
traversals of the data file. For example, if the data file has the
following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;root&gt;
    &lt;a&gt;&lt;/a&gt;
    &lt;a&gt;&lt;/a&gt;
    &lt;b&gt;&lt;/b&gt;
    &lt;a&gt;&lt;/a&gt;
    &lt;b&gt;&lt;/b&gt;
    &lt;b&gt;&lt;/b&gt;
    &lt;a&gt;&lt;/a&gt;
&lt;/root&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>— i.e, inside the root element, the <code>&lt;a&gt;</code> and <code>&lt;b&gt;</code> tags go in random
order, then in order to process <code>&lt;a&gt;</code> and <code>&lt;b&gt;</code> tags in the same
sequence as they go in the data file, the configuration file should look
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;element name="root"&gt;
    &lt;iteration&gt;
        &lt;element name="a"&gt;
        &lt;/element&gt;
        &lt;element name="b"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;element name="root"&gt;
    &lt;iteration&gt;
        &lt;element name="*"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and in order to process all the <code>&lt;a&gt;</code> tags first, and then all the <code>&lt;b&gt;</code>
tags</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;element name="root"&gt;
    &lt;iteration&gt;
        &lt;element name="a"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
    &lt;iteration&gt;
        &lt;element name="b"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to process the zero and then the first tag, regardless of the
names of these tags, the configuration file should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;element name="root"&gt;
    &lt;iteration index="0"&gt;
        &lt;element name="*"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
    &lt;iteration index="1"&gt;
        &lt;element name="*"&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="output-mode">Output Mode</h4>
<div class="paragraph">
<p>When the system switches to output mode, it copies a template fragment
to a specific location in the resulting file, and fills that fragment
with data based on the current data file element. The <code>&lt;output&gt;</code> tags
can only be found inside the <code>&lt;element&gt;</code> tag, but there can be as many
of them as you want, and they can go in random order mixed with the
<code>&lt;iteration&gt;</code> tags. The attributes of the <code>&lt;output &gt;</code> tag are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>sourcesheet</strong> — an optional attribute that points to the template
workbook sheet from which the output range is taken. If not specified,
the current (last used) sheet is used.</p>
</li>
<li>
<p><strong>range</strong> – an optional attribute, template range, that is copied to
the resulting document, for example “A1:M10”, or “5:6”, or “C:C”. Usage
of ranges of rows like “5:6” in left-to-right output mode or of column
ranges like “C:C” in top-to-bottom output mode will cause an error.</p>
</li>
<li>
<p><strong>worksheet</strong> – an optional attribute. If it is defined, a new sheet
is created in the output file, and the output position is moved to the
A1 cell of that sheet. If you define a value for this attribute that is
equal to a constant or XPath expression, the sheet name is substituted
from that constant or the result of the expression.</p>
</li>
<li>
<p><strong> repeatingcols</strong>, <strong>repeatingrows </strong> — optional attributes that go
together with the <strong>worksheet</strong> attribute. They set the header/footer
(repeated on each sheet) columns/rows for a new sheet. The values should
be specified in the "1:2" format with numeration starting from ZERO (for
example, to repeat the first line on each page, you must set
repeatingrows=" 0: 0")</p>
</li>
<li>
<p><strong>pagebreak</strong> — if this attribute is present as <code>pagebreak="true"</code>, the
output of the next section of the report will start with a new page. <em>In
this case, if the current output mode is from top to bottom, then a
horizontal page break is formed, and if it is from left to right, then a
vertical page break is created.</em> Sometimes “widow” and “orphan” lines  in the report are unacceptable (this often relates to the footer  elements
with the results and signatures). If the Xylophone report is created for
instant printing (without manual adjustment), the pagination should be
performed correctly at once.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="representative-example">Example</h3>
<div class="paragraph">
<p>Let’s say we need a report consisting of a title sheet and
several section sheets (names of those are defined by input data). Suppose
the title sheet has a hierarchical list of elements that belong to
different levels and require different render.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pic1.png" alt="pic1">
</div>
</div>
<div class="paragraph">
<p>There may be any amount of sections, this is specified by the input
data. Those sections contain tables with different numbers of lines and
columns:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pic2.png" alt="pic2">
</div>
</div>
<div class="paragraph">
<p>Data presented in the XML file has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;report&gt;
    &lt;titlepage&gt;
        &lt;line name="Line 1" value="10"/&gt;
        &lt;group name = "Line 2" value = "23"&gt;
            &lt;line name = "Line 2.1" value="30"/&gt;
            &lt;line name = "Line 2.2" value="92"/&gt;
        &lt;/group&gt;
        &lt;line name = "Line 3" value="11"/&gt;
    &lt;/titlepage&gt;
    &lt;sheet name="Section A"&gt;
        &lt;column name="2009"/&gt;
        &lt;column name="2010"/&gt;
        &lt;column name="2011"/&gt;
        &lt;row name="Item 1"&gt;
            &lt;cell value = "1"/&gt;
            &lt;cell value = "33"/&gt;
            &lt;cell value = "34"/&gt;
        &lt;/row&gt;
        &lt;row name="Item 2"&gt;
            &lt;cell value = "93"/&gt;
            &lt;cell value = "9"/&gt;
            &lt;cell value = "1"/&gt;
        &lt;/row&gt;
        &lt;row name="Item 3"&gt;
            &lt;cell value = "1"/&gt;
            &lt;cell value = "50"/&gt;
            &lt;cell value = "2"/&gt;
        &lt;/row&gt;
    &lt;/sheet&gt;
    &lt;sheet name="Section B"&gt;

    &lt;/sheet&gt;
&lt;/report&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the template containing layout and substitutionfields for
the title sheet and sections might look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pic3.png" alt="pic3">
</div>
</div>
<div class="paragraph">
<p>Substitution fields have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>~{Xpath-expression}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(tilde, opening curly brace, Xpath expression relative to the current XML
context, closing brace)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The key to creating reports via Xylophone successfully is writing
correct Xpath expressions. Those expressions are extracting data from
current XML file’s context; if you’re not familiar with Xpath you can
learn more about it here
<a href="https://www.w3schools.com/xml/xpath_intro.asp">[1</a>].
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides standard syntax you can also use some specific functions in
XPath expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>current()</strong> — will be replaced with a full XPath expression to the
current node during extraction. It is a full analogue of the XSLT’s
current() function, essential for complex XPath expressions. The
presence of this function is justified for the same reasons as in XSLT’s
current() (please refer to XSLT’s documentation on current() and its
distinction from . (dot)).</p>
</li>
<li>
<p><strong>position()</strong> — an iteration number. Will be replaced with the number
of a current iteration during extraction. Helps with simple sequential
numeration of steps in the report (you can use it instead of placing
numeration to file’s tags).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_helpers">Helpers</h4>
<div class="paragraph">
<p>You may use helpers to further specify cell behaviour. Helpers should be separated with vertical bar from the cell contents.</p>
</div>
<div class="paragraph">
<p>For example <code>Some text ~{foo}|mergeup:"ifequals";</code> will merge cell with the upper cell if its content is equal to that of the upper cell.</p>
</div>
<div class="paragraph">
<p>Currently supported helpers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mergeup, mergeleft</p>
<div class="ulist">
<ul>
<li>
<p>ifequals</p>
</li>
<li>
<p>yes</p>
</li>
<li>
<p>no</p>
</li>
</ul>
</div>
</li>
<li>
<p>backgroundcolor</p>
</li>
<li>
<p>color</p>
</li>
<li>
<p>fontfamily</p>
</li>
<li>
<p>fontsize</p>
</li>
<li>
<p>margin&#8201;&#8212;&#8201;specifies left margin of the cell. The simplest way to introduce hierarcy to the report column.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_illustrative_information">Illustrative information</h4>
<div class="paragraph">
<p>Please note that the template may contain some illustrative information
that won’t end up in the resulting document. It’s a good practice to
provide some explaining information in your template, making further
improvements easier.</p>
</div>
<div class="paragraph">
<p>The descriptor file managing the XML traverse might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;element name="report"&gt;
    &lt;!-- Output of the sole title sheet with hierarchy --&gt;
    &lt;iteration index="0"&gt;
        &lt;element name="titlepage"&gt;
            &lt;!-- Static name of sheet --&gt;
            &lt;output worksheet="Title" range="A3:B4"/&gt;
            &lt;iteration&gt;
                &lt;element name="line"&gt;
                    &lt;output range="A5:B5"/&gt;
                &lt;/element&gt;
                &lt;element name="group"&gt;
                    &lt;output range="A6:B6"/&gt;
                    &lt;iteration&gt;
                        &lt;element name="line"&gt;
                            &lt;output range="A7:B7"/&gt;
                        &lt;/element&gt;
                    &lt;/iteration&gt;
                &lt;/element&gt;
            &lt;/iteration&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
    &lt;!-- Output of all other sheets with summary tables --&gt;
    &lt;iteration&gt;
        &lt;element name="sheet"&gt;
            &lt;!-- A dynamical name of sheet --&gt;
            &lt;output worksheet="~{@name}"/&gt;
            &lt;!-- Columns’ titles from left to right after that --&gt;
            &lt;iteration mode="horizontal"&gt;
                &lt;element name="(before)"&gt;
                    &lt;!-- Output of an empty cell to the top left corner of a summary table --&gt;
                    &lt;output sourcesheet="src" range="A11"/&gt;
                &lt;/element&gt;
                &lt;element name="column"&gt;
                    &lt;output sourcesheet="src" range="B11"/&gt;
                &lt;/element&gt;
            &lt;/iteration&gt;
            &lt;!-- Output of lines: iteration with default output mode (from top to bottom) --&gt;
            &lt;iteration&gt;
                &lt;element name="row"&gt;
                    &lt;!-- Line output, left to right --&gt;
                    &lt;iteration mode="horizontal"&gt;
                        &lt;!-- Line’s title --&gt;
                        &lt;element name="(before)"&gt;
                            &lt;output range="A12"/&gt;
                        &lt;/element&gt;
                        &lt;element name="cell"&gt;
                            &lt;output range="B12"/&gt;
                        &lt;/element&gt;
                    &lt;/iteration&gt;
                &lt;/element&gt;
            &lt;/iteration&gt;
        &lt;/element&gt;
    &lt;/iteration&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-sax-mode-for-huge-reports">The SAX Mode For Huge Reports</h3>
<div class="paragraph">
<p>The SAX mode is suitable for the situations requiring to form reports from
tremendous data input quickly. This mode suggests that data file never
loads into memory fully, and the resulting file formation is managed by
the SAX events with increased processing speed and saving memory,
allowing the system to process huge amounts of data. You can choose the
SAX mode in Xylophone’s launch parameters, as the DOM mode is set by
default. The SAX mode implies those structure limitations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Just one <code>&lt;iteration&gt;</code> tag inside every <code>&lt;element&gt;</code> tag.</p>
</li>
<li>
<p>XPath links can point only to the current element’s attributes;
position() function is supported.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you restructure your XML data file this way, you can have point 1 and
2 executed for a wide range of tasks — for example, you can easily
restructure XML for the “representative example”.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stage-2-formation-of-pdf-files-and-output-for-printing">Phase 2. Output to PDF files and printer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the Excel2Print module you can converse the resulting Excel report
into a PDF file or send it for printing right away.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please note that you can process only XLS files this way, the system
does not support XLSX-to-PDF processing yet.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The system is not capable of outputting to PDF/printer any
picture, shapes and charts, and in the nearest time that won’t be an option.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="excel2print-module-usage">Excel2Print Module Usage</h3>
<div class="paragraph">
<p>The recommended pattern is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Grab('ru.curs:xylophone:6.1.9')
import ru.curs.xylophone.XML2Spreadsheet
import ru.curs.xylophone.Excel2Print

baseDir = '.'
new File(baseDir, 'testdata.xml').withInputStream {
    input -&gt;
        //get the workbook using the toPOIWorkbook method
        workbook = XML2Spreadsheet.toPOIWorkbook(input,
                new File(baseDir, 'descriptor.xml'),
                new File(baseDir, 'template.xls'),
                false, false)
        //initialize Excel2Print converter with created workbook
        e2p = new Excel2Print(workbook)
        //set a file path for the Apache FOP configuration file
        //don't forget to change this file to set the right path to Fonts folder
        e2p.setFopConfig(new File(baseDir, "fop.xconf"))
        //Convert to PDF
        new File(baseDir, 'pdfresult.pdf').withOutputStream {
            pdfresult -&gt;
                e2p.toPDF(pdfresult)
        }

        //If you skip this, the default printer will be used
        e2p.setPrinterName("My LaserJet Printer")
        e2p.toPrinter()
}

println 'Done.'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="known-issues-and-an-alternative-way-for-printout">Known issues and an alternative way for printout</h3>
<div class="paragraph">
<p>During the first launch the system caches fonts’ metrics, so it could
take a while.</p>
</div>
<div class="paragraph">
<p>You can also send PDF file for printing quickly without using Acrobat Reader,
with an open source GhostScript + GhostView system
(<a href="http://www.ghostscript.com/">www.ghostscript.com</a>). The</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gsprint myfile.pdf</code></pre>
</div>
</div>
<div class="paragraph">
<p>command sends PDF file to a printer and also has several additional
parameters.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-01-28 00:34:02 UTC
</div>
</div>
</body>
</html>